!function(e,t,n){function r(e,n){return t.equals(e.length,n.length)?e>n:e.length>n.length}function a(e){var t=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!t||4!==t.length)throw new Error("Invalid state ref '"+e+"'");return{state:t[1],paramExpr:t[3]||null}}function c(){var e={prefixStateName:null,template:"bootstrap3",templateUrl:null,includeAbstract:!1};this.setOptions=function(n){t.extend(e,n)},this.$get=["$state","$stateParams","$rootScope",function(t,c,s){var i=s;s.$on("$viewContentLoaded",function(e){r(e.targetScope.$id,i.$id)&&(i=e.targetScope)});var u=function(e){var t=e.parent||(/^(.+)\.[^.]+$/.exec(e.name)||[])[1];return t},l=function(n,r){for(var s,u,l=a(r),o=0,p=n.length;p>o;o+=1)if(n[o].name===l.state)return;s=t.get(l.state),s.abstract&&!e.includeAbstract||s.ncyBreadcrumb&&s.ncyBreadcrumb.skip||(l.paramExpr&&(u=i.$eval(l.paramExpr)),s.ncyBreadcrumbLink=t.href(l.state,u||c||{}),n.unshift(s))},o=function(e){var n=a(e),r=t.get(n.state);if(r.ncyBreadcrumb&&r.ncyBreadcrumb.parent){var c="function"==typeof r.ncyBreadcrumb.parent,s=c?r.ncyBreadcrumb.parent(i):r.ncyBreadcrumb.parent;if(s)return s}return u(r)};return{getTemplate:function(t){return e.templateUrl?null:t[e.template]?t[e.template]:e.template},getTemplateUrl:function(){return e.templateUrl},getStatesChain:function(n){for(var r=[],a=t.$current.self.name;a;a=o(a))if(l(r,a),n&&r.length)return r;return e.prefixStateName&&l(r,e.prefixStateName),r},getLastStep:function(){var e=this.getStatesChain(!0);return e.length?e[0]:n},$getLastViewScope:function(){return i}}}]}function s(e,n,r){return this.$$templates={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><span ng-switch-when="false">{{step.ncyBreadcrumbLabel}}</span> <span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="page-breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><span ng-switch-when="false">{{step.ncyBreadcrumbLabel}}</span> <span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'},{restrict:"AE",replace:!0,scope:{},template:n.getTemplate(this.$$templates),templateUrl:n.getTemplateUrl(),link:{post:function(a){var c=[],s=function(){o(c);var r=n.$getLastViewScope();a.steps=n.getStatesChain(),t.forEach(a.steps,function(t){if(t.ncyBreadcrumb&&t.ncyBreadcrumb.label){var n=e(t.ncyBreadcrumb.label);t.ncyBreadcrumbLabel=n(r),l(c,n,r,t)}else t.ncyBreadcrumbLabel=t.name})};r.$on("$viewContentLoaded",function(){s()}),s()}}}}function i(e,t,n){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbLabel}}",compile:function(r,a){var c=r.attr(a.$attr.ncyBreadcrumbLast);return c&&r.html(c),{post:function(r){var a=[],c=function(){o(a);var n=t.$getLastViewScope(),c=t.getLastStep();if(c)if(r.ncyBreadcrumbLink=c.ncyBreadcrumbLink,c.ncyBreadcrumb&&c.ncyBreadcrumb.label){var s=e(c.ncyBreadcrumb.label);r.ncyBreadcrumbLabel=s(n),l(a,s,n,r)}else r.ncyBreadcrumbLabel=c.name};n.$on("$viewContentLoaded",function(){c()}),c()}}}}}var u=function(e){if(e.expressions)return e.expressions;var n=[];return t.forEach(e.parts,function(e){t.isFunction(e)&&n.push(e.exp)}),n},l=function(e,n,r,a){t.forEach(u(n),function(t){var c=r.$watch(t,function(){a.ncyBreadcrumbLabel=n(r)});e.push(c)})},o=function(e){t.forEach(e,function(e){e()}),e=[]};s.$inject=["$interpolate","$breadcrumb","$rootScope"],i.$inject=["$interpolate","$breadcrumb","$rootScope"],t.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",c).directive("ncyBreadcrumb",s).directive("ncyBreadcrumbLast",i)}(window,window.angular);